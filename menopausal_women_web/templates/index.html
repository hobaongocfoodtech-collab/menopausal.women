<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Health Advisor üå∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary-pink: #ff4081; --bg-gradient: linear-gradient(135deg, #fff5f8 0%, #fce4ec 100%); }
        body { background: var(--bg-gradient); min-height: 100vh; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        .card { border-radius: 25px; border: none; box-shadow: 0 15px 40px rgba(255,64,129,0.12); border-top: 8px solid var(--primary-pink); }
        .step-header { display: flex; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px dashed #f8bbd0; }
        .step-number { width: 40px; height: 40px; background: var(--primary-pink); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
        .form-label { font-weight: 600; color: #555; margin-bottom: 8px; font-size: 0.95rem; }
        .form-select, .form-control { border-radius: 12px; border: 1.5px solid #eee; padding: 12px; }
        .form-select:focus, .form-control:focus { border-color: var(--primary-pink); box-shadow: 0 0 0 0.25rem rgba(255,64,129,0.1); }
        .btn-predict { background: var(--primary-pink); color: white; border-radius: 50px; padding: 15px 40px; font-weight: bold; font-size: 1.1rem; border: none; transition: 0.3s; }
        .btn-predict:hover { transform: scale(1.05); background: #f50057; color: white; box-shadow: 0 10px 20px rgba(245,0,87,0.3); }
        .instruction { font-size: 0.85rem; color: #888; margin-top: 4px; }
        .result-card { background: white; border-left: 10px solid #4caf50; border-radius: 15px; }
        .badge-info { background: #f3e5f5; color: #7b1fa2; font-weight: normal; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card p-4 p-md-5">
                <div class="text-center mb-5">
                    <h1 class="fw-bold" style="color: var(--primary-pink);">AI HEALTH ADVISOR <span class="header-icon">üå∏</span></h1>
                    <p class="text-muted">H·ªá th·ªëng d·ª± b√°o S·ª©c kh·ªèe t√¢m l√Ω & Ch·∫•t l∆∞·ª£ng cu·ªôc s·ªëng </p>
                </div>

                <div id="section-step1">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h4 class="mb-0 fw-bold">Th√¥ng tin ƒë·ªãnh danh & Nh√¢n kh·∫©u h·ªçc</h4>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-cake-candles me-2"></i>ƒê·ªô tu·ªïi</label>
                            <input type="number" id="Age" class="form-control" placeholder="V√≠ d·ª•: 52">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-weight-scale me-2"></i>Ch·ªâ s·ªë BMI</label>
                            <input type="number" step="0.1" id="BMI" class="form-control" placeholder="V√≠ d·ª•: 22.5">
                            <div class="instruction">T·ª± ƒë·ªông t√≠nh: C√¢n n·∫∑ng / (Chi·ªÅu cao)¬≤</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-person-half-dress me-2"></i>Tr·∫°ng th√°i m√£n kinh</label>
                            <select id="Meno_Status" class="form-select">
                                <option value="0">Ti·ªÅn m√£n kinh / Ch∆∞a m√£n kinh</option>
                                <option value="1">ƒê√£ m√£n kinh ho√†n to√†n</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-clock-rotate-left me-2"></i>S·ªë nƒÉm ƒë√£ m√£n kinh</label>
                            <input type="number" id="Meno_Duration_New" class="form-control" value="0">
                            <div class="instruction">N·∫øu ch∆∞a m√£n kinh, h√£y ƒë·ªÉ l√† 0</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-user-graduate me-2"></i>Tr√¨nh ƒë·ªô h·ªçc v·∫•n</label>
                            <select id="Education_Code" class="form-select">
                                <option value="0">Kh√¥ng ƒëi h·ªçc</option>
                                <option value="1">Ti·ªÉu h·ªçc</option>
                                <option value="2">THCS</option>
                                <option value="3">THPT - Trung c·∫•p</option>
                                <option value="4" selected>ƒê·∫°i h·ªçc - Cao ƒë·∫≥ng</option>
                                <option value="5">Tr√™n ƒë·∫°i h·ªçc</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-wallet me-2"></i>M·ª©c thu nh·∫≠p</label>
                            <select id="Income_Code" class="form-select">
                                <option value="1">D∆∞·ªõi 5 tri·ªáu</option>
                                <option value="2">T·ª´ 5 ƒë·∫øn 10 tri·ªáu</option>
                                <option value="3" selected>Tr√™n 10 tri·ªáu</option>
                                <option value="4">Tr√™n 20 tri·ªáu</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-briefcase me-2"></i>Ngh·ªÅ nghi·ªáp hi·ªán t·∫°i</label>
                            <select id="Job_Code" class="form-select">
                                <option value="1">N·ªôi tr·ª£</option>
                                <option value="2">C√¥ng nh√¢n</option>
                                <option value="3">Nh√¢n vi√™n vƒÉn ph√≤ng</option>
                                <option value="4">Kinh doanh</option>
                                <option value="5">H∆∞u tr√≠</option>
                                <option value="0">Kh√°c</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-heart me-2"></i>T√¨nh tr·∫°ng h√¥n nh√¢n</label>
                            <select id="Marital_Code" class="form-select">
                                <option value="1">C√≥ gia ƒë√¨nh</option>
                                <option value="0">ƒê·ªôc th√¢n / Kh√°c</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label"><i class="fa-solid fa-stethoscoper me-2"></i>B·ªánh m√£n t√≠nh</label>
                            <select id="Chronic_Disease" class="form-select">
                                <option value="0">Kh√¥ng c√≥</option>
                                <option value="1">ƒêang ƒëi·ªÅu tr·ªã b·ªánh m√£n t√≠nh</option>
                            </select>
                        </div>
                    </div>

                    <div class="text-center mt-5">
                        <button class="btn btn-predict" onclick="identify()">X√ÅC NH·∫¨N & PH√ÇN T√çCH NH√ìM üöÄ</button>
                    </div>
                </div>

                <div id="section-step2" class="d-none mt-5">
                    <div class="step-header">
                        <div class="step-number" style="background: #9c27b0;">2</div>
                        <h4 class="mb-0 fw-bold">Kh·∫£o s√°t Tri·ªáu ch·ª©ng Th√≠ch nghi</h4>
                    </div>
                    <div class="alert badge-info mb-4">
                        <i class="fa-solid fa-circle-info me-2"></i>AI ƒë√£ l·ªçc ra c√°c c√¢u h·ªèi quan tr·ªçng nh·∫•t d·ª±a tr√™n nh√≥m c·ªßa b·∫°n. Vui l√≤ng ƒë√°nh gi√° theo thang ƒëi·ªÉm y√™u c·∫ßu.
                    </div>

                    <div class="row g-4" id="questions-area">
                        </div>

                    <div class="text-center mt-5">
                        <button class="btn btn-predict" style="background: #9c27b0;" onclick="finalPredict()">XEM K·∫æT QU·∫¢ CH·∫®N ƒêO√ÅN üìä</button>
                    </div>
                </div>

                <div id="section-result" class="d-none mt-5">
                    <div class="result-card p-4 shadow-sm">
                        <h4 class="fw-bold text-success mb-4"><i class="fa-solid fa-square-poll-vertical me-2"></i>K·∫æT QU·∫¢ D·ª∞ B√ÅO T·ª™ AI</h4>
                        <div class="row text-center">
                            <div class="col-md-6 border-end">
                                <p class="text-muted mb-1">M·ª©c ƒë·ªô CƒÉng th·∫≥ng (PSS)</p>
                                <h1 id="res-pss" class="display-4 fw-bold">--</h1>
                                <span class="badge rounded-pill bg-light text-dark border">Thang ƒëi·ªÉm 0-40</span>
                            </div>
                            <div class="col-md-6">
                                <p class="text-muted mb-1">Ch·∫•t l∆∞·ª£ng cu·ªôc s·ªëng (MENQOL)</p>
                                <h1 id="res-men" class="display-4 fw-bold">--</h1>
                                <span class="badge rounded-pill bg-light text-dark border">Thang ƒëi·ªÉm 1-6</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
const QUESTION_MAP = {
    'PSS_1': 'B·∫°n c√≥ c·∫£m th·∫•y kh√≥ khƒÉn khi ƒë·ªëi m·∫∑t v·ªõi nh·ªØng v·∫•n ƒë·ªÅ d·ªìn d·∫≠p?',
    'PSS_2': 'B·∫°n c√≥ c·∫£m th·∫•y m·∫•t ki·ªÉm so√°t ƒë·ªëi v·ªõi nh·ªØng vi·ªác quan tr·ªçng?',
    'PSS_3': 'B·∫°n c√≥ c·∫£m th·∫•y cƒÉng th·∫≥ng v√† lo l·∫Øng?',
    'PSS_4': 'B·∫°n t·ª± tin v√†o kh·∫£ nƒÉng x·ª≠ l√Ω c√°c v·∫•n ƒë·ªÅ c√° nh√¢n?',
    'PSS_5': 'M·ªçi vi·ªác ƒëang di·ªÖn ra theo √Ω mu·ªën c·ªßa b·∫°n?',
    'PSS_6': 'B·∫°n c·∫£m th·∫•y kh√¥ng th·ªÉ l√†m h·∫øt c√°c vi·ªác c·∫ßn l√†m?',
    'PSS_10': 'Kh√≥ khƒÉn t√≠ch t·ª• v∆∞·ª£t m·ª©c b·∫°n c√≥ th·ªÉ gi·∫£i quy·∫øt?',
    'MEN_HotFlash': 'M·ª©c ƒë·ªô b·ªëc h·ªèa, n√≥ng b·ª´ng m·∫∑t c·ªßa b·∫°n?',
    'MEN_Memory': 'M·ª©c ƒë·ªô gi·∫£m tr√≠ nh·ªõ, hay qu√™n?',
    'MEN_Sleep': 'M·ª©c ƒë·ªô m·∫•t ng·ªß ho·∫∑c kh√≥ ng·ªß?',
    'MEN_Depressed': 'C·∫£m th·∫•y lo √¢u ho·∫∑c tr·∫ßm c·∫£m?',
    'MEN_Impatient': 'C·∫£m th·∫•y m·∫•t ki√™n nh·∫´n, d·ªÖ c√°u g·∫Øt?',
    'MEN_Fatigue': 'C·∫£m th·∫•y m·ªát m·ªèi, thi·∫øu nƒÉng l∆∞·ª£ng?',
    'MEN_Libido': 'Thay ƒë·ªïi ham mu·ªën t√¨nh d·ª•c?',
    'MEN_Weight': 'TƒÉng c√¢n nhanh ch√≥ng?',
    'Supp_Calcium': 'S·ª≠ d·ª•ng Canxi?',
    'Supp_Omega3': 'S·ª≠ d·ª•ng Omega-3?'
};

const DEMO_FIELDS = ['Age', 'BMI', 'Education_Code', 'Income_Code', 'Job_Code', 'Marital_Code', 'Meno_Duration_New', 'Meno_Status', 'Chronic_Disease'];

let clusterId = null;
let savedDemo = {};

async function identify() {
    savedDemo = {};
    DEMO_FIELDS.forEach(f => savedDemo[f] = document.getElementById(f).value);

    const res = await fetch('/get_cluster', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(savedDemo)
    });
    const data = await res.json();
    clusterId = data.cluster;

    const area = document.getElementById('questions-area');
    area.innerHTML = '';
    data.questions.forEach(q => {
        const label = QUESTION_MAP[q] || q;
        const isPSS = q.startsWith('PSS');
        const hint = isPSS ? '0: Kh√¥ng bao gi·ªù -> 4: Lu√¥n lu√¥n' : '1: Kh√¥ng tri·ªáu ch·ª©ng -> 6: R·∫•t n·∫∑ng';
        area.innerHTML += `
            <div class="col-md-6">
                <label class="form-label">${label}</label>
                <input type="number" class="form-control gold-q" data-id="${q}" placeholder="${hint}">
            </div>`;
    });
    document.getElementById('section-step2').classList.remove('d-none');
    window.scrollTo({top: document.getElementById('section-step2').offsetTop - 50, behavior: 'smooth'});
}

async function finalPredict() {
    let fullData = {...savedDemo};
    document.querySelectorAll('.gold-q').forEach(el => fullData[el.dataset.id] = el.value);

    const res = await fetch('/predict', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({cluster: clusterId, full_data: fullData})
    });
    const result = await res.json();

    document.getElementById('section-result').classList.remove('d-none');
    document.getElementById('res-pss').innerText = result.PSS;
    document.getElementById('res-men').innerText = result.MEN;
    window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
}
</script>
</body>
</html>